<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title></title>
  </head>
  <body>
    <p>
      One of the equipment component is using the oracle DBMS to store the history provisioning commands, however due to the capacity limitation, the log could not be saved forever. So the old ones are overwrite with the rotation mechanism.
    </p>
    <p>
      The log is important for the revenue assurance and audition, anyway we have to keep it somewhere else to query for kind of purpose.
    </p>
    <p>
      Here's the solution to dump the oracle data and transfer it to a specific ftp server,
    </p>
    <ol>
      <li>login the secure ftp address 10.1.1.1, port 22
      </li>
      <li>change the directory to /opt/pub/software/tmp/pgw.archive
      </li>
      <li>
        <p>
          you will get the daily provisioning log named with YYYY-MM-DD.pgw.log.gz, e.g. 2011-04-26.pgw.log.gz
        </p>
        <p>
          <strong>tip: use the "date -d" to get the "relative date"</strong>
        </p>
        <pre>
<code>#!/bin/sh
# file name: pgwbk.sh
# usage:
# for backup the daily pgw provisoning log
# put it in crontab if you need it regularly run
today=`date +"%Y%m%d"`
day=`date -d "$today 1 day ago" + "%d"`
yesterday=`date -d "$today 1 day ago" + "%Y-%m-%d"`
/home/oracle/sqluldr2_linux32_10204.bin user=pgw/huawei field=”|” query=”select OPERATOR_NAME, OPERATION_TIME, MML_COMMAND, CMDRESULT, ERRORCODE from OPERATION_LOG_TABLE_$day whe re OPERATION_TIME like ‘$yesterday%’” file=$yesterday.pgw.log log=sqluldr.runlog gzip $yesterday.pgw.log 2&gt;&gt;sqluldr.runlog
scp $yesterday.pgw.log.gz omu@172.16.128.1:/opt/pub/software/tmp/pgw.archive/ &gt;&gt; sqluldr.runlog
rm $yesterday.pgw.log.gz`
</code>
</pre>
      </li>
    </ol>
    <hr />
    <p>
      Last Update: Sep 6, 2013 23:22 @Manila
    </p>
  </body>
</html>
