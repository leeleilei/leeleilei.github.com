<p><strong>Note: I would recommend you use the <a href="http://unetbootin.sourceforge.net">unetbootin</a> to make the Linux bootable USB drive, since it is more easier (GUI) and convinience (auto-download distribution CD, auto-make boot flags). The below process just reach the same target, helping you understand what happened during the <code>unetbootin</code> process.</strong></p>
<hr />
<p>In the very beginning, I thought it was really difficult to install a
linux from a USB, since it requires GRUB, kinds of alternative CD
media, and a "special" cd boot vmlinuz and initrd.gz files. Finally I
realise the power of GRUB, and it could boot anything, event a ISO
file.</p>
<h1>The Media</h1>
<p>You need a portable USB drive or pen drive, whose capacity is larger
than 1GB, and a computer with capability of boot sequence selection</p>
<p>Download the Linux distribution CD image.</p>
<h1>Partition it</h1>
<ol>
<li>
<p>Identify the USB device</p>
<pre><code># dmesg | grep /dev/
</code></pre>
</li>
<li>
<p>Use <code>fdisk</code> to format the partition</p>
<pre><code># fdisk /dev/sdb (run it as root or sudo fdisk /dev/sdb)
press "n" to create a new partition
press "p" to create the primary partition
press "1" to create the number 1 primary partion
press "p" to view the current table, then you shall get the sdb1 now
press "a", then "1" to toggle the sdb1 as bootable
press "t", then "c" to change the system id as "windows 95"
press "w", save all of the partition information to the USB drive
</code></pre>
</li>
</ol>
<h1>Prepare the file system</h1>
<p>Using the ISO file to install the Linux, you shall use a "FAT32" partition to
save the ISO file, otherwise the ISO couldn't be seeked by the GRUB loader</p>
<pre><code>    # mkfs -t vfat /dev/sdb1 (replace sdb1 with your real media partition, do NOT be wrong)
    # mount /dev/sdb1 /mnt
    # cp ubuntu-11.04-desktop-i386.iso /mnt
</code></pre>
<p>or you can copy it from windows system, since the fat32 partition is working
under windows.</p>
<h1>Install the GRUB</h1>
<p>GRUB is the bootloader, which will control how you start the OS, by ISO or by normal media</p>
<pre><code>    # mount /dev/sdb1 /mnt
    # grub-install --root-directory=/mnt /dev/sdb (replace sdb with your real USB drive id)
</code></pre>
<p>Now you got a bootable USB stick bearing the ubuntu installation media.</p>
<h1>Begin Linux Boot</h1>
<ol>
<li>Plugin your USB dirve and boot your system</li>
<li>Press "F12" and select boot from USB/Flash drive</li>
<li>then you will get a "grub&gt;" prompt and stopped, that's what we wanna</li>
<li>
<p>Configure the boot parameter</p>
<pre><code>grub&gt; ls
</code></pre>
<p>you will get a list of partitions including your local hard disk partition and
your USB partition. That's easily identified by the count of partition number,
like (hd0,1)(hd1,1)(hd1,2),(hd1,3),etc. we only have 1 partition on USB, so
(hd0,1) is the USB partition</p>
<pre><code>grub&gt; set root='(hd0,1)'
grub&gt; loopback loop /ubuntu-11.04-desktop-i386.iso
grub&gt; linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=/ubuntu-11.04-desktop-i386.iso
grub&gt; initrd (loop)/casper/initrd.lz
grub&gt; boot
</code></pre>
</li>
</ol>
<h1>Install the Linux</h1>
<p>After you boot into the <code>live CD desktop</code>, you can use the <code>install to harddisk</code> function to install the Linux copy to your local HDD or another USB drive.</p>
<h1>Notes</h1>
<ol>
<li>
<p><code>loop</code> device</p>
<p>The loopback command will assign the "loop" as themedia file (iso)</p>
<p>Use the "TAB" key to let the <code>GRUB</code> to "seek" the possible files</p>
<p>E.g. initrd file here is the <code>initrd.lz</code> not <code>initrd.gz</code>, you can
use <code>TAB</code> after you typing the <code>initrd.</code>. The GRUB will
automatically seek the initrd.lz**</p>
</li>
<li>
<p>GRUB is so powerful to read ISO or file system right before system
   "booted"</p>
</li>
<li>Use <code>FAT32</code> file system bearing the ISO file</li>
<li>You can using your existing <code>grub.cfg</code> (live system) to add the
   installation menuentry.</li>
<li>Do NOT try to install a new system on the same USB drive where your
   iso is</li>
<li>
<p>More examples of boot entry</p>
<pre><code>cat &lt;&lt;EOF&gt; /mnt/boot/grub/grub.cfg
menuentry "Ubuntu Live 9.10 32bit" {
loopback loop /boot/iso/ubuntu-9.10-desktop-i386.iso
linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=/boot/iso/ubuntu-9.10-desktop-i386.iso noeject noprompt --
initrd (loop)/casper/initrd.lz
}

menuentry "Ubuntu Live 9.10 64bit" {
loopback loop /boot/iso/ubuntu-9.10-desktop-amd64.iso
linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=/boot/iso/ubuntu-9.10-desktop-amd64.iso noeject noprompt --
initrd (loop)/casper/initrd.lz
}

menuentry "Grml small 2009.10" {
loopback loop /boot/iso/grml-small_2009.10.iso
linux (loop)/boot/grmlsmall/linux26 findiso=/boot/iso/grml-small_2009.10.iso apm=power-off lang=us vga=791 boot=live nomce noeject noprompt --
initrd (loop)/boot/grmlsmall/initrd.gz
}

menuentry "tinycore" {
loopback loop /boot/iso/tinycore_2.3.1.iso
linux (loop)/boot/bzImage --
initrd (loop)/boot/tinycore.gz
}

menuentry "Netinstall 32 preseed" {
loopback loop /boot/iso/mini.iso
linux (loop)/linux auto url=http://www.panticz.de/pxe/preseed/preseed.seed locale=en_US console-setup/layoutcode=de netcfg/choose_interface=eth0 debconf/priority=critical --
initrd (loop)/initrd.gz
}

menuentry "debian-installer-amd64.iso" {
loopback loop /boot/iso/debian-installer-amd64.iso
linux (loop)/linux vga=normal --
initrd (loop)/initrd.gz
}

menuentry "BackTrack 4" {
linux /boot/bt4/boot/vmlinuz BOOT=casper boot=casper nopersistent rw vga=0x317 --
initrd /boot/bt4/boot/initrd.gz
}

menuentry "Memory test (memtest86+)" {
linux16 /boot/img/memtest86+.bin
}

menuentry "BackTrack ERR" {
loopback loop /boot/iso/bt4-pre-final.iso
linux (loop)/boot/vmlinuz find_iso/filename=/boot/iso/bt4-pre-final.iso BOOT=casper boot=casper nopersistent rw vga=0x317--
initrd (loop)/boot/initrd.gz
}

menuentry "XBMC ERR" {
loopback loop /boot/iso/XBMCLive.iso
linux (loop)/vmlinuz boot=cd isofrom=/dev/sda1/boot/iso/XBMCLive.iso xbmc=nvidia,nodiskmount,tempfs,setvolume loglevel=0 --
initrd (loop)/initrd0.img
}

menuentry "netboot.me" {
loopback loop /boot/iso/netbootme.iso
linux16 (loop)/GPXE.KRN
}

menuentry "debian installer amd64 netboot XEN pressed" {
linux /boot/debian/linux auto preseed/url=http://www.panticz.de/pxe/preseed/xen.seed locale=en_US console-setup/layoutcode=de netcfg/choose_interface=eth0 debconf/priority=critical --
initrd /boot/debian/initrd.gz
}
EOF
</code></pre>
</li>
</ol>
<hr />
<p>Last Updated: Sep 06, 2013 23:10 Manila</p>