<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title></title>
  </head>
  <body>
    <h1>
      Headache
    </h1>
    <p>
      If you were suffering below boring issues, I recommend you using "gawk and shell", no excuse.
    </p>
    <ol>
      <li>I got a 2G text file
      </li>
      <li>I am warried about the memory leak or overflow
      </li>
      <li>I need extract several column of text file
      </li>
      <li>If the line match something, actually I don't need put in column result
      </li>
      <li>I need transform the structured text to CSV
      </li>
      <li>I need fast sort
      </li>
      <li>I need sort by specific columns
      </li>
      <li>I need get the differences of 2 files
      </li>
      <li>I want split
      </li>
      <li>I want combination
      </li>
    </ol>
    <h1>
      Compare
    </h1>
    <pre>
<code>    # diff -y --suppress-common-lines foo1.txt foo2.txt
    line3 line3 value2       | line2 line2 value
                             &gt; line3 line3 value3
                             &gt; line4 line4 value4
                             &gt; line5 line5 value5
</code>
</pre>
    <h1>
      Extract <code>lines</code>
    </h1>
    <h2>
      Extract ISDN
    </h2>
    <pre>
<code>    # cat huabiao.txt | grep -oP "MSISDN=[0-9]{10,13}" | sed 's/MSISDN=//g' &gt; isdn
</code>
</pre>
    <h2>
      Extract ISDN，IMSI and PDP
    </h2>
    <pre>
<code>    # cat huawei_01.txt | awk '{
        if($0 ~ /MSISDN=/) {
            isdn=$0
        }
        if($0 ~ /PDPCNTX=/) {
            pdp=$0
        }
        if($0 ~ /SUBEND/) {
            print isdn,pdp
        }
        isdn=""
        pdp=""
    }' &gt; isdn.pdp.txt
</code>
</pre>
    <h2>
      Multiple PDP
    </h2>
    <pre>
<code>    # cat huawei_01.txt | awk '{
        if($0 ~ /MSISDN=/) {
            isdn=$0
        }

        if($0 ~ /PDPCNTX=/) {
            if(len(pdp)==0) ｛
                pdp=$0
            }
            else {
                pdp=pdp" "$0
            }
        }

        if($0 ~ /SUBEND/) {
            print isdn,pdp
        }
        isdn=""
        pdp=""
    }' &gt; isdn.pdp.txt
</code>
</pre>
    <p>
      <strong>Note: gawk use implicit varible, and the pattern is gonna applied on <em><em>each line</em></em>, remember initialize the <em><em>reused</em></em> varible at end of pattern, such as isdn, imsi, pdp in above sample</strong>
    </p>
    <h1>
      Sort
    </h1>
    <pre>
<code>    # sort -u foo.txt &gt; foo.new
    # sort foo.txt |uniq &gt; foo.new
    # sort -t "," -k2 -u foo.txt
</code>
</pre>
    <h1>
      KI Transform
    </h1>
    <p>
      The source: <code>e.txt</code>,
    </p>
    <pre>
<code>    123120123456789 abcdef0123456789abcdef0123456789 1 2 3
</code>
</pre>
    <p>
      The target: <code>h.txt</code>,
    </p>
    <pre>
<code>    123120123456789 abcdef0123456789abcdef0123456789 3 2 1 0 @ 0
</code>
</pre>
    <p>
      The transformer,
    </p>
    <pre>
<code>    # cat e.txt | awk '{print $1,$2,$5,$4,$3,0 @ 0}' &gt; h.txt
</code>
</pre>
    <hr />
    <p>
      Last Update: Sep 6, 2013 23:22 @Manila
    </p>
  </body>
</html>
