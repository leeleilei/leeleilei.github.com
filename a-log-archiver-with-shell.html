<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <title>A Log Archiver with shell</title>
        <link rel="stylesheet" href="http://leeleilei.github.com/theme/css/main.css">
                <link href="http://leeleilei.github.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="David Lee Atom Feed" />
                
        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://leeleilei.github.com/">David Lee </a></h1>
                <nav><ul>
                                                                                    <li class="active"><a href="http://leeleilei.github.com/category/misc.html">misc</a></li>
                                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://leeleilei.github.com/a-log-archiver-with-shell.html" rel="bookmark"
           title="Permalink to A Log Archiver with shell">A Log Archiver with shell</a></h1>
          </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2013-09-03T21:00:00">
                Tue 03 September 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="http://leeleilei.github.com/author/leeleileigmailcom.html">leeleilei@gmail.com</a>
        </address>
        <p>In <a href="http://leeleilei.github.com/category/misc.html">misc</a>. </p>
<p>tags: <a href="http://leeleilei.github.com/tag/sqluldr.html">sqluldr</a><a href="http://leeleilei.github.com/tag/shell.html">shell</a></p>
</footer><!-- /.post-info -->      <p>One of the equipment component is using the oracle DB to store the history provisioning commands, however due to the capacity limitation, the log could not be saved forever. So the old ones are overwrite with the rotation mechanism.</p>
<p>The log is important for the revenue assurance and audition, anyway we have to keep it somewhere else to query for kind of purpose.</p>
<p>Here’s the solution to dump the oracle data and transfer it to a specific ftp server,</p>
<ol>
<li>login the secure ftp address 10.1.1.1, port 22</li>
<li>change the directory to /opt/pub/software/tmp/pgw.archive</li>
<li>you will get the daily provisioning log named with “YYYY-MM-DD.pgw.log.gz”, e.g. “2011-04-26.pgw.log.gz”</li>
</ol>
<blockquote>
<p>tip: use the “date -d” to get the “relative date”</p>
</blockquote>
<p><code>shell
    #!/bin/sh
    #
    # 2011-04-26, leeleilei&lt;at&gt;gmail&lt;dot&gt;com
    # used for backup the daily pgw provisoning log
    #
    today=`date +”%Y%m%d”`
    day=`date -d “$today 1 day ago” +”%d”`
    yesterday=`date -d “$today 1 day ago” +”%Y-%m-%d”`
    /home/oracle/sqluldr2_linux32_10204.bin user=pgw/huawei field=”|” query=”select OPERATOR_NAME, OPERATION_TIME, MML_COMMAND, CMDRESULT, ERRORCODE from OPERATION_LOG_TABLE_$day whe
    re OPERATION_TIME like ‘$yesterday%’” file=$yesterday.pgw.log log=sqluldr.runlog
    gzip $yesterday.pgw.log 2&gt;&gt;sqluldr.runlog
    scp $yesterday.pgw.log.gz omu@172.16.128.1:/opt/pub/software/tmp/pgw.archive/ &gt;&gt; sqluldr.runlog
    rm $yesterday.pgw.log.gz</code></p>
    </div><!-- /.entry-content -->
    
  </article>
</section>
        <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://leeleilei.github.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>